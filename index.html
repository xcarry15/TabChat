<!-- v0.3.4 | 2025-08-17
- 新增：左下角“历史”按钮和悬浮历史面板（可滚动，默认可见区域至少显示20条）
- 引入 scripts/history.js
- 修复：模式切换不再清空历史，仅“重置对话”按钮会清空
-->
<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>TabChat</title>
  <link rel="stylesheet" href="styles/main.css">
</head>
<body>
  <canvas id="bg" aria-hidden="true"></canvas>
  <button id="settingsBtn" class="btn btn-neutral settings-floating" title="设置" aria-label="设置">设置</button>
  <button id="historyBtn" class="btn btn-neutral history-floating" title="历史会话" aria-label="历史会话">历史</button>
  <main id="app" aria-live="polite">
    <section id="clock" aria-label="当前时间">
      <div id="clock-time" role="timer" aria-live="polite">--:--</div>
      <div id="clock-date" aria-hidden="false">----</div>
    </section>

    <section id="chat" aria-label="聊天与搜索">
      <div class="chat-bar">
        <div class="input-wrap">
          <textarea id="input" rows="1" placeholder="输入内容后 按 Enter 搜索，Ctrl+Enter 由 AI 回复" aria-label="输入框"></textarea>
        </div>
      </div>

      <div class="chat-actions-toolbar" aria-label="操作">
        <div class="toolbar-right">
          <button id="searchBtn" class="btn btn-translucent" title="Enter 搜索" aria-label="搜索">搜索</button>
          <button id="aiBtn" class="btn btn-translucent" title="Ctrl+Enter AI" aria-label="AI 回复">AI</button>
          <button id="translateBtn" class="btn btn-translucent" title="翻译为中文" aria-label="翻译">翻译</button>

          <span id="aiControls" class="toolbar-controls" hidden>
            <button id="aiStopBtn" class="btn btn-translucent" title="停止" aria-label="停止">停止</button>
            <button id="aiResetBtn" class="btn btn-translucent" title="重置对话" aria-label="重置对话">重置</button>
          </span>
        </div>
      </div>

      <div id="aiOutput" class="output" aria-live="polite" hidden>
        <div id="aiContent" class="output-content"></div>
      </div>
      <div id="error" class="error" role="alert" aria-live="assertive" hidden></div>
    </section>
  </main>

  <!-- 历史会话悬浮面板 -->
  <section id="historyPanel" class="history-panel" aria-label="历史会话" hidden>
    <header class="history-header">
      <h3 class="history-title">历史会话</h3>
      <button id="historyCloseBtn" class="btn btn-ghost" aria-label="关闭历史">关闭</button>
    </header>
    <div id="historyList" class="history-list" role="list" aria-live="polite"></div>
    <footer class="history-footer">
      <small class="muted">点击一项可将内容填入输入框</small>
    </footer>
  </section>

  <dialog id="settingsDialog" aria-label="设置">
    <form method="dialog" id="settingsForm">
      <h2>设置</h2>
      <label>
        Base URL
        <input id="baseUrl" type="url" placeholder="https://api.siliconflow.cn/v1">
      </label>
      <label>
        API Key
        <input id="apiKey" type="password" placeholder="粘贴你的 API Key">
      </label>
      <label>
        模型
        <input id="model" type="text" placeholder="deepseek-ai/DeepSeek-V2.5">
      </label>
      <label>
        超时（秒）
        <input id="timeout" type="number" min="5" max="120" step="1" placeholder="30">
      </label>
      <menu>
        <button value="cancel">取消</button>
        <button id="saveSettings" value="default">保存</button>
      </menu>
    </form>
  </dialog>
  
  <template id="advancedSettingsTemplate">
    <fieldset>
      <legend>高级参数</legend>
      <label>
        Temperature
        <input id="temperature" type="number" min="0" max="2" step="0.1" placeholder="0.7">
      </label>
      <label>
        Top P
        <input id="topP" type="number" min="0" max="1" step="0.05" placeholder="1">
      </label>
      <label>
        最大输出（max_tokens）
        <input id="maxTokens" type="number" min="1" step="1" placeholder="2048">
      </label>
      <label>
        重试次数
        <input id="retries" type="number" min="0" max="5" step="1" placeholder="2">
      </label>
      <label>
        初始重试间隔（秒）
        <input id="retryInitialDelaySeconds" type="number" min="0.25" max="10" step="0.25" placeholder="1">
      </label>
    </fieldset>
    <fieldset>
      <legend>对话记忆</legend>
      <label class="checkbox">
        <input id="memoryEnabled" type="checkbox" checked> 启用对话记忆
      </label>
      <label>
        记忆轮数（user+assistant 为一轮）
        <input id="memoryMaxTurns" type="number" min="0" max="32" step="1" placeholder="8">
      </label>
      <label>
        系统提示词（可选）
        <textarea id="systemPrompt" rows="3" placeholder="你是一个有用的助手，回答简洁。"></textarea>
      </label>
    </fieldset>
  </template>

  <script src="scripts/background.js" defer></script>
  <script src="scripts/time.js" defer></script>
  <script src="scripts/settings.js" defer></script>
  <script src="scripts/markdown.js" defer></script>
  <script src="scripts/ai.js" defer></script>
  <script src="scripts/history.js" defer></script>
  <script src="scripts/chat.js" defer></script>
</body>
<!-- 首次加载：Chrome 扩展 → 开发者模式 → 加载已解压 → 选择本目录 -->
</html>


